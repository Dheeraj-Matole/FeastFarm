<% layout('layouts/boilerplate') %>

    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="row">
<div class="col-lg-6 mb-4">
    <div class="card">
        <div class="row g-0">
            <div class="col-md-4">
                <img class="img-fluid rounded-start" src="<%= prod.image %>" alt="<%= prod.name %>" style="object-fit: cover; width: 100%; height: 100%;">
            </div>
            <div class="col-md-8">
                <div class="card-body">
                    <h5 class="card-title display-6"><%= prod.name %></h5>
                    <p class="card-text h5"><strong>Price:</strong> â‚¹<%= prod.price %></p>
                    <% if(currentUser && prod.admin.equals(currentUser._id)) { %>
                        <a href="/products/<%= prod._id %>/edit" class="btn btn-primary btn-sm me-2">Edit</a>
                        <form action="/products/<%= prod._id %>?_method=DELETE" method="POST" class="d-inline">
                            <button type="submit" class="btn btn-danger btn-sm me-2">Delete</button>
                        </form>
                    <% } %>
                    <% if(currentUser) { %>
                        <form action="/cart/add" method="POST" class="d-inline">
                            <input type="hidden" name="userId" value="<%= currentUser._id %>">
                            <input type="hidden" name="productId" value="<%= prod._id %>">
                            <div class="input-group input-group-sm mb-3" style="width: 150px;">
                                <button class="btn btn-outline-secondary mt-3" type="button" onclick="decrementQuantity()">-</button>
                                <input type="number" class="form-control text-center mt-3" name="quantity" id="quantity" value="1" min="1" style="width: 50px;">
                                <button class="btn btn-outline-secondary mt-3" type="button" onclick="incrementQuantity()">+</button>
                                <label for="quantity" class="form-label h5 mt-3 ms-2">  Kg </label>
                            </div>
                            <button type="submit" class="btn btn-success btn-md me-2 mt-3">Add to Cart</button>
                        </form>
                    <% } %>
                    <a href="/products" class="btn btn-secondary btn-md mt-3">Back to Products</a>
                </div>
            </div>
        </div>
    </div>
</div>

                    <div class="col-lg-6">
                        <% if(currentUser) {%>
                        <form action="/products/<%=prod._id%>/reviews" method="POST" novalidate class="needs-validation" autocomplete="off"> 
                            <div class="mb-3">
                                <label for="rating" class="form-label h5">Rating</label>
                                <input class="form-range" type="range" min="1" max="5" name="review[rating]" id="rating">
                            </div>
                            <div class="mb-3">
                                <label for="body" class="form-label h5">Review</label>
                                <textarea class="form-control form-control-lg" name="review[body]" id="body" required></textarea>
                            </div>
                            <button class="btn btn-success btn-md mb-3">Submit</button>
                        </form>
                        <% } %>
                    </div>
                </div> 
                <div class="card">
                    <div class="card-header">
                        <h4>Reviews</h4>
                    </div>
                    <ul class="list-group list-group-flush">
                        <% for (let review of prod.reviews) { %>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <p class="mb-1"><strong>Review:</strong> <%= review.body %></p>
                                    <small class="text-muted">Rating: <%= review.rating %> / 5</small>
                                </div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <span class="badge bg-primary rounded-pill me-2"><%= review.rating %></span>
                                    <% if(currentUser && currentUser._id.equals(review.author)) {%>
                                    <form action="/products/<%=prod._id%>/reviews/<%=review._id %>?_method=DELETE" method="POST" class="d-inline">
                                        <button class="btn btn-danger btn-sm">Delete Review</button>
                                        <% } %>
                                    </form>
                                </div>                                
                            </li>
                        <% } %>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        function incrementQuantity() {
            const quantityInput = document.getElementById('quantity');
            quantityInput.value = parseInt(quantityInput.value) + 1;
        }
    
        function decrementQuantity() {
            const quantityInput = document.getElementById('quantity');
            if (quantityInput.value > 1) {
                quantityInput.value = parseInt(quantityInput.value) - 1;
            }
        }
    </script>
    